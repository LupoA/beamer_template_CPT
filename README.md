Many thanks Mattias Sj√∂ for writing most of this
